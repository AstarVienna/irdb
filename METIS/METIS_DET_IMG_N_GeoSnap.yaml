---
### GeoSnap DETECTOR
object: detector
alias: DET
name: metis_detector_array
description: Teledyne GeoSnap Detector
date_modified: 2021-12-16
changes:
  - 2021-12-16 (OC) some rearrangements, chopnod off by default
  - 2022-01-25 (KL, OC) added DetectorModePropertiesSetter effect

properties:
  temperature: -240
  dit: "!OBS.dit"
  ndit: "!OBS.ndit"
  mindit: 0.011               # seconds, E-REP-NOVA-MET-1191, v2-0
  full_well: !!float 2.8e6    # electrons, E-REP-NOVA-MET-1191, v2-0
  dark_current: !!float 1.e5  # [e-/s], E-REP-NOVA-MET-1191, v2-0
  readout_noise: 12
  layout:
    file_name: "FPA_metis_img_n_geosnap_layout.dat"
  qe_curve:
    file_name: "QE_detector_geosnap.dat"
  linearity:
    file_name: "FPA_linearity_GeoSnap.dat"

effects:
  - name: detector_array_list
    description: METIS IMG-N detector array list
    class: DetectorList
    kwargs:
      file_name: "!DET.layout.file_name"



################################## TBD
  - name: detector_readout_parameters
    desription:
    class: DetectorModePropertiesSetter
    kwargs:
      mode_properties:
        high:
          min_dit: 0.04
          full_well: !!float 1e5
          ron: 70
        low:
          "!DET.min_dit": 1.3
          "!DET.full_well": !!float 1e5
          ron: 14


  - name: qe_curve
    description: Quantum efficiency curves for each detector
    class: QuantumEfficiencyCurve
    kwargs:
      file_name: "!DET.qe_curve.file_name"

  - name: auto_exposure
    description: automatic determination of DIT and NDIT
    class: AutoExposure
    include: true
    kwargs:
      fill_frac: "!OBS.auto_exposure.fill_frac"

  - name: exposure_action
    description: Summing up sky signal for all DITs and NDITs
    class: SummedExposure

  - name: dark_current
    description: METIS GeoSnap dark current
    class: DarkCurrent
    kwargs:
      value: "!DET.dark_current"

  - name: shot_noise
    description: apply poisson shot noise to images
    class: ShotNoise

  - name: detector_linearity
    description: Linearity characteristics of GeoSnap chip
    class: LinearityCurve
    kwargs:
      filename: "!DET.linearity.file_name"

  - name: readout_noise
    description: Readout noise frames
    class: BasicReadoutNoise
    kwargs:
      noise_std: "!DET.readout_noise"
      n_channels: 8

  - name: chopnod
    descriptions: chopping and nodding
    class: ChopNodCombiner
    include: false
    kwargs:
      chop_offsets: "!OBS.chop_offsets"
      nod_offsets: "!OBS.nod_offsets"
      pixel_scale: "!INST.pixel_scale"
